!function(e){function t(t){for(var o,s,i=t[0],c=t[1],u=t[2],d=0,h=[];d<i.length;d++)s=i[d],r[s]&&h.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(t);h.length;)h.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,i=1;i<n.length;i++){var c=n[i];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={1:0},a=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;a.push([34,0,4]),n()}({34:function(e,t,n){(function(e){n(9);const t=n(35),o=n(6),r=n(7),a=n(5),s=n(10);let i;const c={async init(){this.checkUpdates().then(()=>{console.log("[LibPlus] Update done! Next in 60 min"),c.initIntervals()},e=>{c.onCheckUpdatesFailed(e)})},checkUpdates(){return this.isAuthorized().then(e=>e||(console.log("[LibPlus] Unauthorized !!! Reject check updates"),Promise.reject("unauthorized"))).catch(e=>{if("unauthorized"===e)return console.log("[LibPlus] Unauthorized - Try auto-logging..."),c.autologin()}).then(e=>e?c.fetchUpdates():Promise.reject("unauthorized"))},wakeUp(){console.log(`[LibPlus] checking updates... (${(new Date).toISOString()})`),c.checkUpdates().catch(c.onCheckUpdatesFailed)},initIntervals(){i=setInterval(()=>{c.wakeUp()},36e5)},onCheckUpdatesFailed(e){if("unauthorized"!==e)throw Error(e);console.log("[LibPlus] User is unauthorized - background is snoozed!")},autologin(){const e=["isAutologin","login","pass"];return new Promise((t,n)=>{chrome.storage.local.get(e,e=>{let o=chrome.runtime.lastError;o?n(o):t(e)})}).then(e=>{const{isAutologin:n,login:o,pass:r}=e;return n&&o&&r?t.authorize(window.atob(o),windows.atob(r)):Promise.reject("credentials undefined")}).catch(e=>(console.log("[LibPlus] autologin failed"),!1))},fetchDataPage:()=>s.get("https://synergia.librus.pl/przegladaj_oceny/uczen").then(t=>(t.data.replace(/<head>[.\w\W]*<\/head>/,"").replace(/<script.*\/?>(([.\w\W])*?)<\/script>/gm,"").replace(/<img/,"<div"),e(t.data))),fetchUpdates(){console.log("[LibPlus] Fetching updates..."),c.fetchDataPage().then(e=>{const t=o.getData(e);r.init(e);const n=r.parseAll(t.grades);return{grades:n,gpa:a.calcGradePointAverage(n),announcements:t.announcements,events:t.events,messages:t.messages,user:t.user,lastUpdateTime:(new Date).getTime()}}).catch(e=>("unauthorized"===e.message&&c.onUnauthorized(),Promise.reject(e))).then(e=>c.compareVersions(e)).then(e=>{chrome.storage.local.set(e),chrome.runtime.sendMessage({method:"onDataUpdated",data:{updatedData:e}})})},compareVersions(e){const t=["grades"];return new Promise((e,n)=>{chrome.storage.local.get(t,t=>{let o=chrome.runtime.lastError;o?n(o):e(t)})}).then(t=>{let n=!1;return t.grades&&(n=t.grades&&t.grades.length===e.grades.length||e.announcements||e.messages||e.events),{...e,isAnyChange:n}})},authorize(e){const{login:n,pass:o,autologin:r}=e;return t.authorize(n,o).then(e=>(e&&r&&chrome.storage.local.set({isAutologin:!0,login:window.btoa(n),pass:window.btoa(o)}),chrome.runtime.sendMessage({method:"loginSuccess"}),e),e=>(chrome.runtime.sendMessage({method:"loginFailed",data:{errors:e}}),!1)).then(e=>{chrome.storage.local.set({isAuthorized:e})})},isAuthorized:()=>new Promise((e,t)=>{chrome.storage.local.get(["isAuthorized","lastUpdateTime"],n=>{let o=chrome.runtime.lastError;const{isAuthorized:r}=n;o?t(o):void 0===r?t("empty"):e(n.isAuthorized)})}).catch(e=>{if("empty"===e)return t.isAuthorized()}).then(function(e){return chrome.storage.local.set({isAuthorized:e}),e}),onUnauthorized(){chrome.storage.local.set({isAuthorized:!1})}};chrome.runtime.onMessage.addListener(e=>{switch(e.method){case"authorize":c.authorize(e.data);break;case"fetchData":c.fetchUpdates()}return!0}),chrome.runtime.onStartup.addListener(()=>{console.log("[LibPlus] start background script"),c.init()})}).call(this,n(1))},35:function(e,t,n){const o=n(10),r={headers:{"Content-Type":"application/x-www-form-urlencoded"}},a="https://api.librus.pl/OAuth/Authorization?client_id=46&response_type=code&scope=mydata",s="https://api.librus.pl/OAuth/Authorization?client_id=46",i="https://api.librus.pl/OAuth/Authorization/Grant?client_id=46",c="https://synergia.librus.pl/przegladaj_oceny/uczen",u={authorize(e,t){const n=new FormData;return n.append("action","login"),n.append("login",e),n.append("pass",t),o.get(a).then(()=>o.post(s,n,r)).then(e=>{if("ok"!==e.data.status)return Promise.reject(Error("failed"))}).then(()=>o.get(i)).then(()=>!0)},isAuthorized:async()=>o.get(c).then(e=>-1!==e.data.indexOf("jeste≈õ zalogowany jako:"))};e.exports=u}});